---
show: step
version: 1.0 
---

# 数据库事务管理

## 课程介绍

本课程介绍了如何使用数据库的事务功能。

#### 请点击右侧选择使用的实验环境

#### 部署架构：
本课程中 SequoiaDB 巨杉数据库的集群拓扑结构为三分区单副本，其中包括：1个 SequoiaSQL-MySQL 数据库实例节点、1个引擎协调节点，1个编目节点与3个数据节点。

![图片描述](https://doc.shiyanlou.com/courses/1469/1207281/8d88e6faed223a26fcdc66fa2ef8d3c5)

详细了解 SequoiaDB 巨杉数据库系统架构：
* [SequoiaDB 系统架构](http://doc.sequoiadb.com/cn/sequoiadb-cat_id-1519649201-edition_id-0)

#### 实验环境
课程使用的实验环境为 Ubuntu Linux 16.04 64 位版本。SequoiaDB 数据库引擎以及 SequoiaSQL-MySQL 实例均为 3.4 版本。



## 检查集群以及数据库实例是否已启动
```
su - sdbadmin
sdblist -l -m local
/opt/sequoiasql/mysql/bin/sdb_sql_ctl listinst
/opt/sequoiasql/postgresql/bin/sdb_sql_ctl listinst
```

操作截图：
![检查集群以及数据库实例是否已启动](https://doc.shiyanlou.com/courses/1480/1207281/43fa875113512dce1537a215042f7c38)


## 事务提交
1) 连接数据库，创建集合空间和集合
```
su - sdbadmin
sdb
db = new Sdb
db.createCS("foo")
db.foo.createCL("bar")
```

>Note:
>
>用户 sdbadmin 的密码为 sdbadmin

2) 打开事务，并插入一些记录
```
db.transBegin()
db.foo.bar.insert({id:1,name:"aa"})
db.foo.bar.insert({id:2,name:"bbb"})
```

操作截图：
![初始化](https://doc.shiyanlou.com/courses/1480/1207281/79c1fd7b93d26031bdfb614f885e0e1f)

3) 提交事务并检查插入的记录是否已存在
```
db.transCommit()
db.foo.bar.find()
```

操作截图：
![提交事务](https://doc.shiyanlou.com/courses/1480/1207281/f9cfc893d65a8b2a72810bc9bce90d42)



## 回滚事务
1) 往上一步创建的集合中再次插入一些不同的记录

2) 回滚事务并检查新插入的记录是否已回滚，不在集合中


## 删除测试数据，退出连接
```
db.dropCS("foo")
quit
```

 
## 总结

Sequoiadb是一个分布式数据库，可以存储海量的结构化和非结构化数据，并提供多种接口实例，以方便应用程序的访问。事务是保证数据一致性的关键功能，sequoiadb支持事务功能。本课程简单介绍了如何使用数据库的事务功能，包括：打开事务，提交事务，回滚事务。


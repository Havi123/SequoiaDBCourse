## 挑战 

完成集群的备份恢复操作,存储引擎的数据操作,快照和监控

## 挑战介绍

在生产环境中，出于对数据安全方面更严格的考虑，希望能够对整个数据库进行定期的数据备份，以便在未来系统出现异常时，能够在灾难环境中进行数据恢复。
管理员在对SequoiaDB集群做数据备份和恢复工作时，应该要时刻注意分布式数据库与关系型数据库的不同，即数据备份和恢复都会涉及到多台服务器的数据库服务，而不只是在某一台服务器上做相应的操作。

#### 知识点

数据库的备份

## 挑战内容

1) 创建集合空间company和集合employee并导入记录(id:10001, name:'Georgi', age:48),(id:10002, name:'Bezalel', age:21);

2) 全量备份到目录(/opt/sequoiadb/tmp)

3) 再次插入新纪录(id:10003, name:'Parto', age:33)

4) 增量备份到目录(/opt/sequoiadb/tmp)

5) 删除集合空间company

6) 停止集群,全量恢复并检查

7) 停止集群,增量恢复并检查

8) 用snapshot(8)查看该表编目信息

9) 删除测试数据并退出


## 挑战要求

1)完成全量备份和增量备份
2)完成增量恢复和增量恢复



## 示例代码
1) 创建集合空间和集合并导入一些记录
```
su - sdbadmin
sdb
db = new Sdb
db.createCS("company")
db.company.createCL( "employee",{ ShardingKey:{ id: 1 }, ShardingType: "hash", Partition: 4096, ReplSize: 1 } )
db.company.employee.insert([{id:10001, name:"Georgi", age:48}, {(id:10002, name:"Bezalel", age:21)}])
```

2) 全量备份
```
db.backup({Name:"fullback",Path:"/opt/sequoiadb/tmp/%g",Overwrite:true,Description:"full backup"})
```

3) 再次插入一些新记录
```
db.company.employee.insert([{id:10003, name:"Parto", age:33}])
```

4) 增量备份
```
db.backup({Name:"fullback",Path:"/opt/sequoiadb/tmp/%g",EnsureInc:true})
```

5) 删除集合空间
```
db.dropCS("company")
quit
```

6) 全量恢复并检查
```
mv /opt/sequoiadb/tmp/group3/full.back.2 /opt/sequoiadb/tmp
mv /opt/sequoiadb/tmp/group3/full.back.bak.1 /opt/sequoiadb/tmp
sdbstop --all
sdbrestore -p /opt/sequoiadb/tmp/SYSCatalogGroup/ -n fullback -b 0
sdbrestore -p /opt/sequoiadb/tmp/group1/ -n fullback -b 0
sdbrestore -p /opt/sequoiadb/tmp/group2/ -n fullback -b 0
sdbrestore -p /opt/sequoiadb/tmp/group3/ -n fullback -b 0
sdbstart
sdb
db = new Sdb
db.company.employee.find({},{id:null})
quit
```

7) 增量恢复并检查
```
sdbstop --all
sdbrestore -p /opt/sequoiadb/tmp/group3/ -n fullback -b 1
sdbstart
sdb
db = new Sdb
db.company.employee.find({},{id:null})
```
8) db.snapshot(8,{Name:"company.employee"})

9) 删除测试数据并退出
```
db.dropCS("company")
quit
```

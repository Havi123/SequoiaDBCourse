---
show: step
version: 1.0
enable_checker: true
---

# 手工创建集群

## 课程介绍

本课程介绍了如何通过命令行的方式手工创建集群。

#### 请点击右侧选择使用的实验环境

#### 部署架构：
本课程中 SequoiaDB 巨杉数据库的集群拓扑结构为三分区单副本，其中包括：1个引擎协调节点，1个编目节点与3个数据节点。

#### 实验环境
课程使用的实验环境为 Ubuntu Linux 16.04 64 位版本。SequoiaDB 数据库为 3.4 版本。


##  检查安装介质是否已准备好
安装目录已经提前放置在 /home/shiyanlou 目录。

1）进入安装包放置目录；
```
cd /home/shiyanlou
```

2）查看安装包；
```
ls -trl
```

能看到一个安装包 sequoiadb-3.4-linux_x86_64.tar.gz 

操作截图：

![检查安装包](https://doc.shiyanlou.com/courses/1480/1207281/736a2463740a7e973e6ba41207ad9469)

## 切换用户

切换至 root 用户，在 `[sudo] password for shiyanlou:` 后输入当前用户的密码;

```
sudo su
```

> Note:
> 当前用户的密码在右侧工具栏 [SSH直连]


## 安装数据库集群

1）解压安装包； 

```
tar -xvf ./sequoiadb-3.4-linux_x86_64.tar.gz
```

2）进入解压目录；
```
cd sequoiadb-3.4
```

3）增加可执行权限；

```
chmod u+x sequoiadb-3.4-linux_x86_64-installer.run
```

4）运行安装脚本；
```
./sequoiadb-3.2-linux_x86_64-installer.run --mode text --SMS false
```
命令行安装方式选项详细说明：
* [数据库安装](http://doc.sequoiadb.com/cn/sequoiadb-cat_id-1432191000-edition_id-0)




## 检查数据库配置服务状态

1）确认系统提示“sdbcm is running”表示服务正在运行；

```
service sdbcm status
```

2）切换为 SequoiaDB 安装用户；

```
su - sdbadmin
```

>Note:
>
>用户 sdbadmin 的密码为 sdbadmin


3）检查sdb版本；

```
sequoiadb --version
```


## 手工创建集群

本小节使用手工的方式创建集群模式的 SequoiaDB 巨杉数据库集群。

##### 创建临时协调节点

该节点只是为了创建其它节点而临时使用，安装完毕后需要删除该节点。

1）在 Linux 命令行中进入 SequoiaDB Shell 交互式界面；

```
sdb
```

2） 连接到本地的集群管理服务进程 sdbcm；

```
var oma = new Oma("localhost", 11790) ;
```

3）创建临时协调节点；

```
oma.createCoord(18800, "/opt/sequoiadb/database/coord/18800") ;
```

4）启动临时协调节点；
```
oma.startNode(18800) ;
```

#### 创建编目节点

通过命令配置和启动编目节点，编目节点为一种逻辑节点，其中保存了数据库的元数据信息，而不保存其他用户数据。

1）连接到临时协调节点，在 shell 命令中输入；
```
var db = new Sdb("localhost",18800) ;
```

2）创建一个编目节点组；
```
db.createCataRG("主机名", 11800, "/opt/sequoiadb/database/cata/11800") ;
```

>Note:
>由于实验环境为动态生成hostname，执行时需要把"主机名"替换为真实的值；

#### 创建数据节点
由于创建的集群为3分区单副本，需要创建3个数据节点分别是 group1、group2和group3。

1）创建数据节点组；

```
var dataRG1 = db.createRG("group1") ;
var dataRG2 = db.createRG("group2") ;
var dataRG3 = db.createRG("group3") ;
```

2）添加数据节点；

```
dataRG1.createNode("主机名", 11820, "/opt/sequoiadb/database/data/11820") ;
dataRG2.createNode("主机名", 11830, "/opt/sequoiadb/database/data/11830") ;
dataRG3.createNode("主机名", 11840, "/opt/sequoiadb/database/data/11840") ;
```

3）启动数据节点组；

```
dataRG1.start() ;
dataRG2.start() ;
dataRG3.start() ;
```

#### 创建协调节点

1）创建协调节点组；

```
var rg = db.createCoordRG() ;
```

2）创建协调节点；

```
rg.createNode("主机名", 11810, "/opt/sequoiadb/database/coord/11810") ;
```

3）启动协调节点；

```
rg.start() ;
```


#### 删除临时协调节点，完成部署

1）删除临时协调节点；

```
oma.removeCoord(18800) ;
```

2）退出 SequoiaDB Shell；

```
quit ;
```

3）检查集群节点状态；

```
sdblist -l -m local
```

操作截图：
![命令行方式创建集群](https://doc.shiyanlou.com/courses/1480/1207281/c75e802689b8d68d3c7ba3ba002665bc)


## 总结

本课程简单介绍了如何通过命令行的方式手工创建集群。在集群环境下，SequoiaDB 数据库需要三种角色的节点，分别为：协调节点、编目节点和数据节点，每种角色的节点至少启动一个，才能构成完整的集群模式。


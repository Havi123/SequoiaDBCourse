---
show: step
version: 1.0
enable_checker: true
---

# 手工创建集群

## 课程介绍

本课程介绍了如何通过命令行的方式手工创建集群。

#### 请点击右侧选择使用的实验环境

#### 部署架构：
本课程中 SequoiaDB 巨杉数据库的集群拓扑结构为三分区单副本，其中包括：1个引擎协调节点，1个编目节点与3个数据节点。

#### 实验环境
课程使用的实验环境为 Ubuntu Linux 16.04 64 位版本。SequoiaDB 数据库引擎以及 SequoiaSQL-MySQL 实例均为 3.4 版本。



##  检查安装介质是否已准备好
安装目录已经提前放置在 /home/shiyanlou 目录。

```
cd /home/shiyanlou
```
能看到一个安装包 sequoiadb-3.4-linux_x86_64.tar.gz 

操作截图：
![检查安装包](https://doc.shiyanlou.com/courses/1480/1207281/736a2463740a7e973e6ba41207ad9469)


## 安装sdb集群
1）解压安装包； 

```
tar -xvf ./sequoiadb-3.4-linux_x86_64.tar.gz
```

2）进入解压目录；
```
cd sequoiadb-3.4
```

## 切换用户

1）命令行输入更新 root 密码命令；

```
sudo passwd root
```

2）在 `[sudo] password for shiyanlou:` 后输入当前用户的密码；

> Note:
> 当前用户的密码在右侧工具栏 [SSH直连]

3）当前用户密码验证通过后, 输入需要设置的 root 超级管理员账户密码 `Enter new UNIX password:` ；

4）再次输入密码，验证输入的密码 `Retype new UNIX password:`；

5）出现 `passwd: password updated successfully` 字样，表示超级管理员 root 账户密码设置成功；

6）切换至 root 用户，验证超级管理账户密码是否更新成功，验证通过则成功切换到超级管理员 root 账户；
```
su root
```

7）增加可执行权限；

```
chmod u+x sequoiadb-3.4-linux_x86_64-installer.run
```

## 安装数据库
8）运行安装脚本；
```
./sequoiadb-3.2-linux_x86_64-installer.run --mode text --SMS false
```
选项详细说明：
* [数据库安装](http://doc.sequoiadb.com/cn/sequoiadb-cat_id-1432191000-edition_id-0)


按照提示一步一步安装(要选一下安装语言，同意协议以及哪种数据库实例，其余的全部敲回车选默认值)

安装完成后的截图：
![安装完成](https://doc.shiyanlou.com/courses/1480/1207281/590058544bef538f93a9dc0db5d026c8)



## 安装完毕后检查sdb版本和数据库服务

1）确认系统提示“sdbcm is running”表示服务正在运行；

```
service sdbcm start
```

2）切换为 SequoiaDB 安装用户；

```
su - sdbadmin
```

>Note:
>
>用户 sdbadmin 的密码为 sdbadmin


3）检查sdb版本；

```
sdb --version
```


## 手工创建集群

本小节使用手工的方式创建集群模式的 SequoiaDB 巨杉数据库集群。

##### 创建临时协调节点

该节点只是为了创建其它节点而临时使用，安装完毕后需要删除该节点。

1）在 Linux 命令行中进入 SequoiaDB Shell 交互式界面；

```
sdb
```

2） 连接到本地的集群管理服务进程 sdbcm；

```
var oma = new Oma("localhost", 11790) ;
```

3）创建临时协调节点；

```
oma.createCoord(18800, "/opt/sequoiadb/database/coord/18800") ;
```

4）启动临时协调节点；
```
oma.startNode(18800) ;
```

#### 创建编目节点

通过命令配置和启动编目节点，编目节点为一种逻辑节点，其中保存了数据库的元数据信息，而不保存其他用户数据。

1）连接到临时协调节点，在 shell 命令中输入；
```
var db = new Sdb("localhost",18800) ;
```

2）创建一个编目节点组；
```
db.createCataRG("主机名", 11800, "/opt/sequoiadb/database/cata/11800") ;
```


#### 创建数据节点
本示例中只创建1个数据节点，实际生产中可按照磁盘个数进行设置。

1）创建数据节点组；

```
var dataRG = db.createRG("group1") ;
```

2）添加数据节点；

```
dataRG.createNode("主机名", 11820, "/opt/sequoiadb/database/data/11820") ;
```

3）启动数据节点组；

```
dataRG.start() ;
```

#### 创建协调节点

1）创建协调节点组；

```
var rg = db.createCoordRG() ;
```

2）创建协调节点；

```
rg.createNode("主机名", 11810, "/opt/sequoiadb/database/coord/11810") ;
```

3）启动协调节点；

```
rg.start() ;
```


#### 删除临时协调节点，完成部署

1）删除临时协调节点；

```
oma.removeCoord(18800) ;
```

2）退出 SequoiaDB Shell；

```
quit ;
```

3）检查一下集群状态；

```
sdblist -l -m local
```

操作截图：
![命令行方式创建集群](https://doc.shiyanlou.com/courses/1480/1207281/c75e802689b8d68d3c7ba3ba002665bc)


## 总结

Sequoiadb是一个分布式数据库，可以存储海量的结构化和非结构化数据，并提供多种接口实例，以方便应用程序的访问。本课程简单介绍了如何通过命令行的方式手工创建集群，以及在独立模式下部署数据库。


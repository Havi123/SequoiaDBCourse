---
show: step
version: 1.0
enable_checker: true
---

# 数据库强弱一致性配置

## 课程介绍

本课程介绍巨杉数据在不同一致性设置下，数据的同步方式。

**请点击右侧选择使用的实验环境**

**部署架构**

本课程中的SequoiaDB巨杉数据库的集群拓扑结构为三副本。

**实验环境**

课程使用的实验环境为Ubuntu Linux 16.04 64位版本。

## 查看数据库状态

`sdblist  -t all -l -m local`

**操作截图：**

## ![830-1](pic\830-1.png)

## 强弱一致性配置

#### 一致性默认设置

**1）创建集合空间**

`db.createCS("TEST_CS")`

**2）创建集合**

创建集合时可以配置一致性参数ReplSize,该参数默认值为1。

当设置为1时，请求需同步到至少1个复制组指定数量个节点之后，数据库写操作才返回应答给客户端。

`db.TEST_CS.createCL("TEST_CL",{ReplSize:1})`

**3）插入数据**
`db.TEST_CS.TEST_CL.insert({"id":1,"city":"BEIJIN"`})

**操作截图：**

 ![830-2](pic\830-2.png)



## 弱一致性配置

**1）修改集合一致性配置**

使用alter方法可以修改集合的ReplSize参数。
当该参数修改为-1时，表示写请求需同步到该复制组若干活跃的节点之后，数据库写操作才返回应答给客户端。

`db.TEST_CS.TEST_CL.alter({ReplSize:-1})`
**2）插入数据**

`db.TEST_CS.TEST_CL.insert({"id":2,"city":"SHANGHAI"})`

**操作截图：**

 ![830-3](pic\830-3.png)



## 强一致性配置

**1）修改集合一致性配置**

当ReplSize参数设置为0时，表示写请求需同步到该复制组的所有节点之后，数据库写操作才返回应答给客户端。

db.TEST_CS.TEST_CL.alter(ReplSize:0)

**2）插入数据**
db.TEdb.TEST_CS.TEST_CL.insert({"id":3,"city":"GUANGZHOU"})

**操作截图：**

 ![830-4](pic\830-4.png)

**查看集合中所有数据**

`db.TEST_CS.TEST_CL.find()`

 ![830-5](pic\830-5.png)

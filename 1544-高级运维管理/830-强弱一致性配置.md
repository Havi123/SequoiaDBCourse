---
show: step
version: 1.0
enable_checker: true
---


# 数据库强弱一致性配置

## 课程介绍

本课程介绍巨杉数据在不同一致性设置下，数据的同步方式。


#### 请点击右侧选择使用的实验环境

#### 部署架构：

本课程中的SequoiaDB巨杉数据库的集群拓扑结构为三分区单副本。

![图片描述](https://doc.shiyanlou.com/courses/1544/1207281/edad10d1fca39ab74e2d0a1c01d34154)

详细了解 SequoiaDB 巨杉数据库系统架构：
* [SequoiaDB 系统架构](http://doc.sequoiadb.com/cn/sequoiadb-cat_id-1519649201-edition_id-0)

**实验环境**

课程使用的实验环境为 Ubuntu Linux 16.04 64 位版本。SequoiaDB 数据库引擎为 3.4 版本。

## 切换用户及查看数据库版本

#### 切换到 sdbadmin 用户

部署 SequoiaDB 巨杉数据库的操作系统用户为 sdbadmin。

```
su - sdbadmin
```
>Note:
>
>用户 sdbadmin 的密码为 sdbadmin

#### 查看巨杉数据库版本

查看 SequoiaDB 巨杉数据库引擎版本

```
sequoiadb --version
```
操作截图：

![图片描述](https://doc.shiyanlou.com/courses/1469/1207281/b4082b0d6d6bdf89d229aa713a53759d)

## 查看节点启动列表

查看 SequoiaDB 巨杉数据库引擎节点列表

```
sdblist 
```

操作截图：

![图片描述](https://doc.shiyanlou.com/courses/1469/1207281/02fcaa58ac27e91688ead137fa748d6e)

>Note:
>
>如果显示的节点数量与预期不符，请稍等初始化完成并重试该步骤

## 强弱一致性配置

#### 一致性默认设置


1）通过 Linux 命令行进入 SequoiaDB Shell；

```
sdb
```

2）通过 javascript 语言连接协调节点，获取数据库连接；

```javascript
var db = new Sdb ("localhost",11810) ;
```

3）创建 company_domain 逻辑域；

```javascript
db.createDomain ("company_domain", ["group1", "group2", "group3"], { AutoSplit : true }) ;
```

4）创建 company 集合空间；

```javascript
db.createCS ("company", { Domain : "company_domain" }) ;
```

5）创建 employee 集合；

创建集合时可以配置一致性参数ReplSize,该参数默认值为1。当该值设置为 1 - 7：表示写请求需同步到该复制组指定数量个节点之后，数据库写操作才返回应答给客户端。

```javascript
db.company.createCL ("employee", {"ShardingKey" : { "_id" : 1} , "ShardingType" : "hash" , "ReplSize" : -1 , "Compressed" : true , "CompressionType" : "lzw" , "AutoSplit" : true , "EnsureShardingIndex" : false }) ;
```


## 弱一致性配置

1）修改集合一致性配置

使用alter方法可以修改集合的ReplSize参数。
当该参数修改为-1时，表示写请求需同步到该复制组若干活跃的节点之后，数据库写操作才返回应答给客户端。

```javascript
db.company.employee.alter ( { ReplSize : -1 } ) ;
```


## 强一致性配置

1）修改集合一致性配置

当ReplSize参数设置为0时，表示写请求需同步到该复制组的所有节点之后，数据库写操作才返回应答给客户端。
```javascript
db.company.employee.alter ( { ReplSize : 0 } ) ;
```

## 总结
通过本课程我们了解了 SequoiaDB 巨杉数据库引擎如何指定强弱一致性配置。

---
show: step
version: 3.0
enable_checker: true
---



# 数据库弹性扩展能力

## 课程介绍

本课程主要介绍 SequoiaDB 巨杉数据库的弹性扩展能力。同时受限于实验环境，数据库节点均在同一台服务器上演示，扩展步骤和原理与在多台服务器上原理保持一致。

### 部署架构

本课程中的 SequoiaDB 巨杉数据库的集群拓扑结构为三分区单副本。

![810-1](https://doc.shiyanlou.com/courses/1544/1207281/edad10d1fca39ab74e2d0a1c01d34154)

关于 SequoiaDB 巨杉数据库系统架构的详细信息，请参考如下链接：

* [SequoiaDB 系统架构](http://doc.sequoiadb.com/cn/sequoiadb-cat_id-1519649201-edition_id-0)

### 实验环境

课程使用的实验环境为 Ubuntu Linux 16.04 64 位版本。

## 切换用户及查看数据库版本

### 切换到 sdbadmin 用户

部署 SequoiaDB 巨杉数据库和 SequoiaSQL-MySQL 实例的操作系统用户为 sdbadmin。

```shell
su - sdbadmin
```

>Note:
>
>用户 sdbadmin 的密码为 `sdbadmin`

### 查看巨杉数据库版本

查看 SequoiaDB 巨杉数据库引擎版本。

```shell
sequoiadb --version
```

操作截图：

![810-2](https://doc.shiyanlou.com/courses/1469/1207281/b4082b0d6d6bdf89d229aa713a53759d)

## 查看节点启动列表

查看 SequoiaDB 巨杉数据库引擎节点列表。

```shell
sdblist
```

操作截图：

![810-3](https://doc.shiyanlou.com/courses/1469/1207281/02fcaa58ac27e91688ead137fa748d6e)

>Note:
>
>如果显示的节点数量与预期不符，请稍等节点初始化完成后再重试该步骤。

## 数据库扩展

本次实验所有扩展均在一台服务器上完成，多服务器扩展原理与此相同。在当前分区组中创建节点，语法：

```javascript
rg.createNode( <host>, <service>, <dbpath>, [config] ) ;
```

参数描述：

| 参数名 | 参数类型   | 描述 | 是否必填 |
| ----- | --------- | ----------- | ------- |
| host | string | 指定节点的主机名。 | 是 |
| service  | 	int/string     | 节点端口号。    | 是 |
| dbpath  | string     | 1. 数据文件路径，用于存放节点数据文件，请确保数据管理员（安装时创建，默认为 sdbadmin ）用户有写权限； <br> 2. 如果配置路径不以“/”开头，数据文件存放路径将是数据库管理员用户（默认为 sdbadmin ）的主目录（默认为 /home/sequoiadb ）+ 配置的路径。    | 是 |
| config  | Json 对象     | 节点配置信息，如配置日志大小，是否打开事务等，具体可参考数据库配置。    | 否 |

### 新增协调节点

1）在 Linux 命令行中进入 SequoiaDB Shell 交互式界面；

```shell
sdb
```

2）使用 JavaScript 连接协调节点，并获取数据库连接；

```javascript
var db = new Sdb ("localhost",11810) ;
```

3）获取现有协调节点信息；

```javascript
var coordRG = db.getRG ("SYSCoord") ;
```

> Note:
>
> "SYSCoord" 为现有协调节点的名字。

4）增加新的协调节点，“主机名”参数需要修改为本机的主机名；

```javascript
var coordNode=coordRG.createNode ( "主机名", 11910, "/opt/sequoiadb/database/coord/11910/", { logfilenum : 5 , transactionon : true } ) ;
```

5）启动新增协调节点；

```javascript
coordNode.start() ;
```

### 新增编目节点

1）获取现有编目节点信息；

```javascript
var cataRG = db.getRG ("SYSCatalogGroup") ;
```

> Note:
>
> "SYSCatalogGroup" 为现有编目节点的名字。

2）增加新的编目节点，“主机名”参数需要修改为本机的主机名；

```javascript
var cataNode=cataRG.createNode ( "主机名", 11900, "/opt/sequoiadb/database/cata/11900/", { logfilenum : 5 , transactionon : true } ) ;
```

3）启动新增编目节点；

```javascript
cataNode.start() ;
```

### 新增数据节点

1）新增数据节点信息；

```javascript
var dataRG = db.createRG ("group4") ;
```

2）添加数据节点的信息，“主机名”参数需要修改为本机的主机名；

```javascript
var dataNode=dataRG.createNode("主机名", 11850, "/opt/sequoiadb/database/data/11850/", { logfilenum : 5 , transactionon : true } ) ;
```

3）启动新增数据节点；

```javascript
dataNode.start() ;
```

4）退出 SequoiaDB Shell；

```javascript
quit ;
```

5）查看数据库扩展后状态

```shell
sdblist  -t all -l -m local
```

操作截图：

 ![810-4](https://doc.shiyanlou.com/courses/1544/1207281/5ad9b922385ea36fd732e160e5b1353e)

此时新增的编目节点和数据节点已经加入集群。

> Note:
>
> 如果是在新服务器上进行扩容，新增服务器的 hostname 和 ip 地址需要添加到所有服务器的 /etc/hostname 文件中。

## 总结

通过本课程，我们学会了如何在已有节点的数据库集群中实现弹性扩容，增加协调节点、编目节点和数据节点。

---
show: step
version: 2.0
enable_checker: true
---

# 数据库弹性扩展能力


## 课程介绍

本课程主要介绍Sequoiadb巨杉数据库的弹性扩展能力。同时受限于实验环境，数据库节点均在同一台服务器上演示，扩展步骤和原理与在多台服务器上原理保持一致。

**请点击右侧选择使用的实验环境**

**部署架构**

本课程中的SequoiaDB巨杉数据库的集群拓扑结构为三分区单副本。

![图片描述](https://doc.shiyanlou.com/courses/1544/1207281/edad10d1fca39ab74e2d0a1c01d34154)

详细了解 SequoiaDB 巨杉数据库系统架构：
* [SequoiaDB 系统架构](http://doc.sequoiadb.com/cn/sequoiadb-cat_id-1519649201-edition_id-0)

**实验环境**

课程使用的实验环境为Ubuntu Linux 16.04 64位版本。

## 切换用户及查看数据库版本

#### 切换到 sdbadmin 用户

部署 SequoiaDB 巨杉数据库和 SequoiaSQL-MySQL 实例的操作系统用户为 sdbadmin。
```
su - sdbadmin
```
>Note:
>
>用户 sdbadmin 的密码为 sdbadmin

#### 查看巨杉数据库版本

查看 SequoiaDB 巨杉数据库引擎版本

```
sequoiadb --version
```
操作截图：

![图片描述](https://doc.shiyanlou.com/courses/1469/1207281/b4082b0d6d6bdf89d229aa713a53759d)

## 查看节点启动列表

查看 SequoiaDB 巨杉数据库引擎节点列表

```
sdblist 
```

操作截图：

![图片描述](https://doc.shiyanlou.com/courses/1469/1207281/02fcaa58ac27e91688ead137fa748d6e)

>Note:
>
>如果显示的节点数量与预期不符，请稍等初始化完成并重试该步骤


## 数据库扩展

本次实验所有扩展均在一台服务器上完成，多服务器扩展原理与此相同。在当前分区组中创建节点，语法：

```
rg.createNode( <host>, <service>, <dbpath>, [config] )
```

参数描述：

| 参数名 | 参数类型   | 描述 | 是否必填 |
| ----- | --------- | ----------- | ------- |
| host | string | 指定节点的主机名。 | 是 |
| service  | 	int/string     | 节点端口号。    | 是 |
| dbpath  | string     | 1. 数据文件路径，用于存放节点数据文件，请确保数据管理员（安装时创建，默认为sdbadmin）用户有写权限； <br> 2. 如果配置路径不以“/”开头，数据文件存放路径将是数据库管理员用户（默认为sdbadmin）的主目录（默认为/home/sequoiadb）+ 配置的路径。    | 是 |
| config  | Json 对象     | 节点配置信息，如配置日志大小，是否打开事务等，具体可参考数据库配置。    | 否 |

## 新增协调节点

协调节点为一种逻辑节点，其中并不保存任何用户数据信息也不参与数据的匹配与读写操作，而仅仅是将请求分发到所需要处理的数据节点。

1）在 Linux 命令行中进入 SequoiaDB Shell 交互式界面；

```
sdb
```

2）使用 JavaScript 连接协调节点，并获取数据库连接；

```javascript
var db = new Sdb ("localhost",11810) ;
```

3）获取现有编目节点信息；

```
var coordRG = db.getRG ("SYSCoord") ;
```

> Note:"SYSCatalogGroup"为现有编目节点的名字。

4）增加新的编目节点，“主机名”，为本机的主机名；

```
var coordNode=coordRG.createNode ( "主机名", 11910, "/opt/sequoiadb/database/coord/11910/", { logfilenum : 5 , transactionon : true } )
```

5）启动新增编目节点；

```
coordNode.start() ;
```


## 新增编目节点

编目节点为一种逻辑节点，其中保存了数据库的元数据信息，而不保存其他用户数据。

1）获取现有编目节点信息；

```
var cataRG = db.getRG ("SYSCatalogGroup") ;
```

> Note:"SYSCatalogGroup"为现有编目节点的名字。

2）增加新的编目节点，“主机名”，为本机的主机名；

```
var cataNode=cataRG.createNode ( "主机名", 11900, "/opt/sequoiadb/database/cata/11900/", { logfilenum : 5 , transactionon : true } )
```

3）启动新增编目节点；

```
cataNode.start() ;
```


## 新增数据节点
数据节点为一种逻辑节点，其中保存用户数据信息。

1）新增数据节点信息；

```
var dataRG = db.createRG ("group4")
```

2）添加数据节点的信息；

```
var dataNode=dataRG.createNode("主机名", 11850, "/opt/sequoiadb/database/data/11850/", { logfilenum : 5 , transactionon : true } )
```


3）启动新增数据节点；

```
dataNode.start()
```

查看数据库扩展后状态

 ![810-5](https://doc.shiyanlou.com/courses/1544/1207281/5ad9b922385ea36fd732e160e5b1353e)

此时新增的编目节点和数据节点已经加入集群。

> Note:
>
> 如果是在新服务器上进行扩容，新增服务器的hostname和ip地址需要添加到所有服务器的/etc/hostname文件中。

## 总结
通过本课程，我们学会了如何在已有节点的数据库集群中实现弹性扩容，增加协调节点、编目节点和数据节点。

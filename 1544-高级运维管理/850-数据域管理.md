---
show: step
version: 1.0
enable_checker: true
---
# 数据域管理

## 课程介绍

本课程主要介绍巨杉数据库中数据域。通过本课程了解域的概念，掌握域的使用方法。

**请点击右侧选择使用的实验环境**

**部署架构**

本课程中的SequoiaDB巨杉数据库的集群拓扑结构为三分区单副本。

**实验环境**

课程使用的实验环境为Ubuntu Linux 16.04 64位版本。

## 查看数据库状态

`sdblist  -t all -l -m local`

**操作截图：**

 ![850-1](https://doc.shiyanlou.com/courses/1544/1207281/7821c6a1c8586deadcbf9fdc22b65ddd)

## 数据域管理

1）登录sdb客户端并创建连接

```
db=new Sdb()
```

2）创建域

```
db.createDomain( 'mydomain', [ 'group1', 'group2'],{ AutoSplit: true })
```

 这个域包含了两个数据组:group1和group2 。同时AutoSplit参数指定自动切分散列分区集合。

3）查看域信息

```
db.listDomains()
```

4）创建集合空间

```
db.createCS('TEST_CS',{Domain:'mydomain'})
```

创建集合空间时指定了域mydomain，此后基于这个集合空间所创建的集合，其保存的数据将存储在mydomain这个域中的两个数据组上。

5）创建集合

```
db.TEST_CS.createCL('TEST_CL',{ShardingKey:{id:1}, ShardingType:"hash", Partition: 1024})
```

这里创建了一个hash分区的集合。

6）插入数据

运行如下shell脚本，该脚本用于模拟插入数据。

```
#!/bin/bash
i=1
sdb -s "db=new Sdb()"
while [ $i -le 10 ]
do
a=`tr -dc "0-9" < /dev/urandom | head -c 6`
b=`tr -dc "a-zA-Z" < /dev/urandom | head -c 8`
sdb -s "db.TEST_CS.TEST_CL.insert({id:$a,name:'$b'})"
i=`expr $i + 1`
done
```

**7）查看数据分布**

在sdb的控制台执行如下命令，查看数据分布情况。

```
db.snapshot(SDB_SNAP_COLLECTIONS)
```

其中TotalRecords记录了每个数据保存的记录数。

**操作截图：**

 ![850-2](https://doc.shiyanlou.com/courses/1544/1207281/68cd63ea4ab4e7f9d76a0832ae34431c)

8）修改域

向已有域中添加数据组。

```
domain=db.getDomain('mydomain')
domain.addGroups({Groups:['group3']})
```

查看修改后域的信息。

```
db.listDomains()
```

9）删除域

需要先删除域上所有的集合后，方能清理域。

```
db.dropCS("TEST_CS")
db.dropDomain('mydomain')
```

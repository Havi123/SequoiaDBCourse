---
show: step
version: 2.0
enable_checker: true
---

# 数据域管理

## 课程介绍

本课程讲述巨杉数据库数据域的内容。通过本课程了解域的概念，掌握域的使用方法。
#### 域的概念：
域（Domain）是由若干个复制组（ReplicaGroup）组成的逻辑单元。每个域都可以根据定义好的策略自动管理所属数据，如数据切片和数据隔离等。详细了解域的概念：
* [SequoiaDB 域的概念](http://doc.sequoiadb.com/cn/index-cat_id-1432190649-edition_id-208)

#### 请点击右侧选择使用的实验环境

#### 部署架构：

本课程中的SequoiaDB巨杉数据库的集群拓扑结构为三分区单副本。

![图片描述](https://doc.shiyanlou.com/courses/1544/1207281/edad10d1fca39ab74e2d0a1c01d34154)

详细了解 SequoiaDB 巨杉数据库系统架构：
* [SequoiaDB 系统架构](http://doc.sequoiadb.com/cn/sequoiadb-cat_id-1519649201-edition_id-0)

**实验环境**

课程使用的实验环境为 Ubuntu Linux 16.04 64 位版本。SequoiaDB 数据库引擎为 3.4 版本。

## 切换用户及查看数据库版本

#### 切换到 sdbadmin 用户

部署 SequoiaDB 巨杉数据库的操作系统用户为 sdbadmin。

```
su - sdbadmin
```
>Note:
>
>用户 sdbadmin 的密码为 sdbadmin

#### 查看巨杉数据库版本

查看 SequoiaDB 巨杉数据库引擎版本

```
sequoiadb --version
```
操作截图：

![图片描述](https://doc.shiyanlou.com/courses/1469/1207281/b4082b0d6d6bdf89d229aa713a53759d)

## 查看节点启动列表

查看 SequoiaDB 巨杉数据库引擎节点列表

```
sdblist 
```

操作截图：

![图片描述](https://doc.shiyanlou.com/courses/1469/1207281/02fcaa58ac27e91688ead137fa748d6e)

>Note:
>
>如果显示的节点数量与预期不符，请稍等初始化完成并重试该步骤

## 创建数据域

1）通过 Linux 命令行进入 SequoiaDB Shell；

```
sdb
```

2）通过 javascript 语言连接协调节点，获取数据库连接；

```javascript
var db = new Sdb ("localhost", 11810) ;
```

3）创建域；

```
db.createDomain ( 'company_domain', [ 'group1', 'group2'], { AutoSplit: true } )
```

> 这个域包含了两个数据组:group1和group2 。同时AutoSplit参数指定自动切分散列分区集合。

3）查看域信息；

```
db.listDomains () ;
```

4）创建集合空间；

```
db.createCS('company', { Domain : 'company_domain' } ) ;
```

创建集合空间时指定了域 company_domain，此后基于这个集合空间所创建的集合，其保存的数据将存储在 company_domain 这个域中的两个数据组上。

5）创建集合，分区方式为 hash ，分区键为 empno；

```javascript
db.company.createCL ("employee", {"ShardingKey" : { "empno" : 1 } , "ShardingType" : "hash" , "ReplSize" : -1 , "Compressed" : true , "CompressionType" : "lzw" , "AutoSplit" : true , "EnsureShardingIndex" : false }) ;
```


6）写入测试数据
使用 JavaScript 的 for 循环向  employee 集合中写入 1000 条数据；
```javascript
for (var i = 0 ; i < 1000 ; i++) { db.company.employee.insert ({ ename : "TEST", age : 20 }) }
```

7）通过查看集合信息，获取数据分布；

```
db.snapshot ( SDB_SNAP_COLLECTIONS ) ;
```

其中TotalRecords记录了每个数据保存的记录数。

**操作截图：**

 ![850-2](https://doc.shiyanlou.com/courses/1544/1207281/68cd63ea4ab4e7f9d76a0832ae34431c)

## 修改数据域
数据域可以增加数据组和减少数据组

#### 增加数据组

增加数据组后，如果需用把原有部分数据放置到这个组上需用使用 split 方法对数据进行切分。

1）获取数据域；
```
var domain=db.getDomain ('company_domain') ;
```

2）向已有域中添加数据组；

```
domain.addGroups ( { Groups : ['group3'] } ) ;
```

3）查看修改后域的信息；

```
db.listDomains()
```

#### 减少数据组

删减数据域中的数据组需用把该数据组中的数据 split 到其他数据组中。

1）获取数据域；
```
var domain=db.getDomain ('company_domain') ;
```

2）向已有域中添加数据组；

```
domain.removeGroups ( { Groups : ['group3'] } ) ;
```

3）查看修改后域的信息；

```
db.listDomains()
```



#### 删除数据域
清理数据域，需要确保数据域上没有集合空间。

1）删除集合空间 company；
```
db.dropCS ("employee") ;
```
2）清理数据域；
```
db.dropDomain ('company_domain');
```

## 总结
本课程讲述了域的概念，同时对域的使用进行了实际操作。

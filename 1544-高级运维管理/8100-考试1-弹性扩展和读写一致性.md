# 考试1-弹性扩展和读写一致性

## 挑战介绍

高速运转的大数据时代中,大量高速运转的数据对分布式数据库的存储要求可谓是寄予厚望,已不再只是以往单纯的存储使用

#### 知识点

1）Sequoiadb弹性拓展功能

2）读写强弱一致性

3）Sequoiadb高可用

4）多维分区规划

5）日志分析

## 挑战内容

1）新增数据节点组group9和数据节点11890;

2）创建集合空间company,创建ReplSize为0的强一致集合employee,以及ReplSize为-1的弱一致性集合employee2;

3）插入employee表数据为(id:10001, name:'Georgi', age:48),查看数据是否正常;

4）三副本数据组分别有11810,21810,31810,停用11810;

5）插入employee表数据为(id:10002, name:'Bezalel', age:21)

5）删除集合空间company;

6）创建域mydomain,其中域包含有group1,group2,group3;

7）创建集合空间company,存放于mydomain域中

8）在company集合空间中创建以字段tx_date分区的主表employee;

9) 创建集合空间company_2020,存放于mydomain域中;

10）在company_2020集合空间中创建子表employee_01和employee_02,并关联主表;

11）插入数据(id:10001, tx_date:"2020-02-22"), (id:10002, tx_date:"2020-01-11"), (id:10003, tx_date:"2020-01-13");

12）用snapshot查看company.employee的集合快照信息;

13）查看集群中所有协调节点和数据节点的日志路径

## 挑战要求

1）完成sequoiadb和spark关联表的创建;

2）插入的两条数据要在spark以及sequoiadb正确显示;

3）进行SparkSQL 执行计划的分析
 
## 示例代码

1）弹性拓展 
```
sdb 'db = new Sdb("localhost",11810)'

sdb 'dataRG = db.createRG("group9")'

sdb 'dataRG.createNode("sdbserver1", 11890,"/opt/sequoiadb/database/data/11890/")'
```
2）读写强弱一致性
```
sdb 'db.company.createCL("employee",{ReplSize:1})'


sdb 'db.company.createCL("employee2",{ReplSize:-1})'
```
3）Sequoiadb高可用
```
sdb 'db.company.employee.insert({id:10001, name:"Georgi", age:48})'

sdb 'db.company.employee.find()'

/opt/sequoiadb/bin/sdbstop -p 11810;

sdb 'db.company.employee.insert({id:10002, name:"Bezalel", age:21})'

sdb 'db.company.employee.find()'

sdb 'db.dropCS("company")'
```
4）多维分区规划
```
sdb 'db.createDomain('mydomain',['group1','group2','group3'])'

sdb 'db.createCS("company",{Domain:"mydomain"})'

sdb 'db.company.createCL('employee',{IsMainCL:true,ShardingKey:{'tx_date':1},ShardingType:'range' })'

sdb 'db.createCS("company_2020",{Domain:"mydomain"})'

sdb 'db.company_2020.createCL('employee_01',{{ShardingKey:{"tx_date":1},ShardingType:"hash",Partition:4096,Compressed:true,AutoSplit:true})'

sdb 'db.company_2020.createCL('employee_02',{{ShardingKey:{"tx_date":1},ShardingType:"hash",Partition:4096,Compressed:true,AutoSplit:true})'

sdb 'db.company.employee.attachCL('company_2020.employee_01',{LowBound:{'tx_date':'2020-01-01'},UpBound:{tx_date::'2020-02-01'}})'

sdb 'db.company.employee.attachCL('company_2020.employee_02',{LowBound:{'tx_date':'2020-02-01'},UpBound:{tx_date:'2020-03-01'}})'

sdb 'db.company.employee.insert([{id:10001, tx_date:"2020-02-22"}, {id:10002, tx_date:"2020-01-11"}, {id:10003, tx_date:"2020-01-13"}])'

sdb 'db.company_2020.employee_01.find()'

sdb 'db.company_2020.employee_02.find()'
```
5）性能监控
```
sdb 'db.snapshot(4,{Name:"company.employee"})'
```
6）日志路径
```
sdb 'db.snapshot(13)'
```


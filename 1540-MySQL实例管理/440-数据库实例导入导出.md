---
show: step
version: 1.0
enable_checker: true
---
# 数据库实例导入导出


## 课程介绍
本课程主要讲解 MySQL 数据库的导入导出操作， 其中包含 CSV 格式导入导出和基于 mysqldump 工具的导入导出。

#### 请点击右侧选择使用的实验环境

#### 部署架构
本课程中 SequoiaDB 巨杉数据库的集群拓扑结构为三分区单副本，其中包括：1个 SequoiaSQL-MySQL 数据库实例节点、1个引擎协调节点，1个编目节点与3个数据分区，9个数据节点。

![图片描述](https://doc.shiyanlou.com/courses/1540/1207281/bcf1c4b3404f34cb22cd48494c10135c)

详细了解 SequoiaDB 巨杉数据库系统架构：
* [SequoiaDB 系统架构](http://doc.sequoiadb.com/cn/sequoiadb-cat_id-1519649201-edition_id-0)


#### 实验环境
课程使用的实验环境为 Ubuntu Linux 16.04 64 位版本。SequoiaDB 数据库引擎以及 SequoiaSQL-MySQL 实例均为 3.4 版本。


## 切换用户及查看数据库版本

#### 切换到 sdbadmin 用户

部署 SequoiaDB 巨杉数据库和 SequoiaSQL-MySQL 实例的操作系统用户为 sdbadmin。
```
su - sdbadmin
```
>Note:
>
>用户 sdbadmin 的密码为 sdbadmin

#### 查看巨杉数据库版本

查看 SequoiaDB 巨杉数据库引擎版本
```
sequoiadb --version
```
操作截图：

![图片描述](https://doc.shiyanlou.com/courses/1540/1207281/03eb5c621476f2788a52a6ea755b23bd)

#### 查看节点启动列表

查看 SequoiaDB 巨杉数据库引擎节点列表

```
sdblist 
```

操作截图:  
![图片描述](https://doc.shiyanlou.com/courses/1540/1207281/cdc72e13c0eb5bedfbeb94c800c94f36)

>Note:
>
>如果显示的节点数量与预期不符，请稍等初始化完成并重试该步骤

#### 检查 MySQL 实例进程

查看 MySQL 数据库实例
```
/opt/sequoiasql/mysql/bin/sdb_sql_ctl listinst
```

操作截图:
![图片描述](https://doc.shiyanlou.com/courses/1540/1207281/92856e2e05fee65495cb876332cd34c6)

查看数据库实例进程
```
ps -elf | grep mysql
```

操作截图:
![图片描述](https://doc.shiyanlou.com/courses/1540/1207281/41b259ef9f2b7f16466b3d89606998c4)


## CSV 导出

#### 导出导入参数配置

进行导出导入参数配置
```
cat /opt/sequoiasql/mysql/database/3306/auto.cnf
```
参数配置如下：
```shell
## 导入导出参数配置
secure_file_priv = "/tmp"
```
> **注意**:  
> 此参数默认为NULL， 表示不允许导入导出操作，需要在配置文件中进行更改

重启 MySQL 数据库实例
```
/opt/sequoiasql/mysql/bin/sdb_sql_ctl restart myinst
```

操作截图:
![图片描述](https://doc.shiyanlou.com/courses/1540/1207281/5283c813ee3ade24aff6a574d92b86bf)

#### 登录到 MySQL 实例

登录 MySQL 实例
```
/opt/sequoiasql/mysql/bin/mysql -h 127.0.0.1 -P 3306 -u root -p
```

操作截图:
![图片描述](https://doc.shiyanlou.com/courses/1540/1207281/b667a6cc7f74c4b19d832efe32054996)

#### CSV格式数据导出

进行 company 数据库
```sql
USE company ;
```

执行 sql 语句进行导出， 其中字段以逗号(,)分隔，以双引号(")作为字符串标识符，以回车换行(\r\n)作为记录分割符：
```sql
SELECT * FROM employee   
INTO OUTFILE '/tmp/employee_export.csv'   
FIELDS TERMINATED BY ','
OPTIONALLY ENCLOSED BY '"'
ESCAPED BY '"'
LINES TERMINATED BY '\r\n';
```

操作截图:
![图片描述](https://doc.shiyanlou.com/courses/1540/1207281/c62172a9fa38ff7b4f72d0dc7578e958)

#### 导出的 CSV 格式数据检查

导出的数据检查
```
cat /tmp/employee_export.csv ;
```

操作截图:
![图片描述](https://doc.shiyanlou.com/courses/1540/1207281/36e0df8705c6e58423bb2b1742b796f1)


## CSV 导入

#### 创建临时表

在 MySQL 实例 company 数据库中创建导入测试的分区表 employee_import_test
```sql
USE company ;
CREATE TABLE employee_import_test (
    emp_no      INT             NOT NULL,
    birth_date  DATE            NOT NULL,
    first_name  VARCHAR(14)     NOT NULL,
    last_name   VARCHAR(16)     NOT NULL,
    gender      ENUM ('M','F')  NOT NULL,    
    hire_date   DATE            NOT NULL,
    PRIMARY KEY (emp_no)
)
ENGINE=sequoiadb COMMENT="雇员表, sequoiadb:{ table_options: { ShardingKey: { 'emp_no': 1 }, ShardingType: 'hash','Compressed':true,'CompressionType':'lzw','AutoSplit':true,'EnsureShardingIndex':false } }";
```

操作截图:  
![图片描述](https://doc.shiyanlou.com/courses/1540/1207281/76ac20a679d5c5385fc2cb6eeb6b4085)


#### CSV 格式数据导入

导入语句操作
```sql
LOAD DATA INFILE '/tmp/employee_export.csv'
INTO TABLE employee_import_test
FIELDS TERMINATED BY ','
OPTIONALLY ENCLOSED BY '"'
ESCAPED BY '"'
LINES TERMINATED BY '\r\n'; 
```

操作截图:  
![图片描述](https://doc.shiyanlou.com/courses/1540/1207281/aa015f1b4c09645db376c41e83c69325)


#### 导入的 CSV 格式数据检查

导出的数据检查
```sql
SELECT * FROM employee_import_test ;
```

操作截图:
![图片描述](https://doc.shiyanlou.com/courses/1540/1207281/070afbf72f3d105ad2ddc394048aec73)


## mysqldump 导出

#### mysqldump 工具导出

mysqldump 工具按表导出 /tmp/employee_import_test.sql
```
/opt/sequoiasql/mysql/bin/mysqldump -h 127.0.0.1 -u root -proot  company employee_import_test > /tmp/employee_import_test.sql
```
> **注意**  
> mysqldump 导出的是 SQL 逻辑执行语句， 其有比较多的参数命令，可通过 mysqldump --help 罗列其中的参数进行查看

#### mysqldump工具导出数据检查
```
cat /tmp/employee_import_test.sql
```

操作截图:
![图片描述](https://doc.shiyanlou.com/courses/1540/1207281/8067899cacdbb5c9b0b3487ba970de85)

> **注意**：  
> 因为内容较多， 仅截了图中的部分内容


## mysqldump 导入

#### 清理数据表

登录 MySQL 实例
```
/opt/sequoiasql/mysql/bin/mysql -h 127.0.0.1 -P 3306 -u root -p
```

操作截图:
![图片描述](https://doc.shiyanlou.com/courses/1540/1207281/b667a6cc7f74c4b19d832efe32054996)

删除表 employee_import_test， 为后面导入测试做准备
```sql
USE company ;
DROP TABLE employee_import_test ;
```

操作截图:
![图片描述](https://doc.shiyanlou.com/courses/1540/1207281/ef0bc6e2b07cff4afb3c3aae7daf5000)


#### mysqldump 工具导入

mysqldump 导出后生成的文件是sql语句的集合，可以直接执行。
```sql
SOURCE /tmp/employee_import_test.sql;
```

操作截图:
![图片描述](https://doc.shiyanlou.com/courses/1540/1207281/edf9df0f650cb413beb0b57f72122b94)

> **注意**：  
> 因为内容较多， 仅截了图中的部分内容


#### mysqldump 工具导入检查

mysqldump 导出后生成的文件是sql语句的集合，可以直接执行。
```sql
USE company ;
SELECT * FROM employee_import_test ; 
```
> **注意**：  
> 因为我们导出的是数据表， 所以导入的时候， 需要选择好相应的数据库

操作截图:
![图片描述](https://doc.shiyanlou.com/courses/1540/1207281/1f6ffbdfddd92debb6eaf42cfba6f62d)


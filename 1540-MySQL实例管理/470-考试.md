
# MySQL实例管理

## 挑战介绍

MySQL 是一款开源的关系型数据库管理系统，也是目前最流行的关系型数据库管理系统之一，支持标准的 SQL 语言。 SequoiaDB 支持创建MySQL实例，完全兼容MySQL语法和协议，用户可以使用SQL语句访问 SequoiaDB 数据库，完成对数据的增、删、查、改操作以及其他MySQL语法操作。

SequoiaDB支持MySQL 5.7.24+ 版本

此挑战是对Mysql的事务管理,数据迁移和备份,普通索引创建，熟悉MySQL实例的操作。

#### 知识点

1) 创建Mysql实例

2) Mysql事务的提交和回滚

3) 创建索引

4) Mysql数据的导入和导出

5) Mysql的数据备份

## 挑战内容

1) 创建一个mysql实例myinst,并创建company数据库以及employee数据表,插入信息（id:10001,name:'Georgi',age:48）

2) 开始Mysql事务,插入数据(id:10002, name:'Bezalel', age:21),然后查询employee表信息,最后提交事务;

3) 开始Mysql事务,插入数据(id:10003, name:'lazhu', age:22),然后查询employee表信息,不提交然后回滚事务,在进行表信息查询;

4) 在employee数据表创建普通索引id_Index,字段为id;

5) 查看SDB是否有id_Index这个索引;

6) 导出employee表数据至/opt/sequoiasql/tmp/employee_export.csv下;

7) 清空employee表数据并执行导入数据操作;

8) 对employee表进行备份,备份路径为/opt/sequoiasql/tmp/employee.sql;

9) 清空employee表数据并执行备份恢复操作;

## 挑战要求

1) 正确创建数据库实例和索引

2) 正确执行事务的提交和回滚操作

3) 正确对表数据信息执行导入导出操作

4) 准备备份数据库信息
 
## 示例代码

1) 创建数据库实例
```
/opt/sequoiasql/mysql/bin/sdb_sql_ctl addinst myinst -D database/3306/
```
2) 数据操作
```
    /opt/sequoiasql/mysql/bin/mysql  -h 127.0.0.1 -P 3306 -u root 
    CREATE DATABASE company;
    USE company;
    CREATE TABLE employee  (id INT , name VARCHAR(128), age INT) ;
    INSERT INTO employee (id,name, age) VALUES (10001,"Georgi",48) ;
    CREATE INDEX id_Index on employee(id);
    sdb 'db = new Sdb("localhost",11810)'
    sdb 'db.company.employee.listIndexes()'
```
3) 事务命令:
```
    START TRANSACTION;
        INSERT INTO employee (id,name, age) VALUES (10002,"Bezalel",21) ;
        SELECT * FROM employee;
    COMMIT;

    START TRANSACTION;
        INSERT INTO employee (id,name, age) VALUES (10003,"lazhu",22) ;
        SELECT * FROM employee;
    ROLLBACK;
    SELECT * FROM employee;
```
4）迁移操作命令：
```shell
# csv 导出
SELECT * FROM employee
INTO OUTFILE '/opt/sequoiasql/tmp/employee_export.csv'   
FIELDS TERMINATED BY ','
OPTIONALLY ENCLOSED BY '"'
ESCAPED BY '"'
LINES TERMINATED BY '\r\n';
```
# csv 导入
```
LOAD DATA INFILE '/opt/sequoiasql/tmp/employee_export.csv'
INTO TABLE employee_import_test
FIELDS TERMINATED BY ','
OPTIONALLY ENCLOSED BY '"'
ESCAPED BY '"'
LINES TERMINATED BY '\r\n'; 
```

5）备份操作命令
```
/opt/sequoiasql/mysql/bin/mysqldump -h 127.0.0.1 -u root -proot  company employee > /opt/sequoiasql/tmp/employee.sql

SOURCE /opt/sequoiasql/tmp/employee.sql;
```



# JSON 实例应用

## 挑战介绍

对分布式存储引擎中的数据，SequoiaDB 巨杉数据库支持通过 JSON API 的方式直接进行查询与修改。SequoiaDB 巨杉数据库存储引擎的交互式命令行界面为 SequoiaDB Shell，使用 JavaScript 作为其脚本开发语言。

#### 知识点
1）创建集合空间和集合；

2）给集合插入数据；

3）更新集合中的数据；

4）删除集合中的数据；

## 挑战内容

1）创建域 company_domain ，在域下创建集合空间 company ， 在集合空间下创建集合 employee ；  

2）给创建的 employee 集合插入下面 6 条数据；  
      { "empno" : 10001 , "ename" : "Georgi" , "age" : 48 }  
      { "empno" : 10002 , "ename" : "Bezalel" , "age" : 21 }  
      { "empno" : 10003 , "ename" : "Parto" , "age" : 33 }  
      { "empno" : 10004 , "ename" : "Chirstian" , "age" : 40 }  
      { "empno" : 10005 , "ename" : "Kyoichi" , "age" : 23 }  
      { "empno" : 10006 , "ename" : "Anneke" , "age" : 19 }  

3）连接查询集合 employees 中age 大于20，小于30的数据；

4）将集合 employees 中 empno 为 10001 的记录的 age 更改为34；

5）删除集合 employees 中 empno 为 10006 的记录删除；


## 挑战要求

1）正确创建集合空间和集合；

2）正确使用 JSON 的增、删、查、改功能；


# SequoiaFS 实例应用

## 挑战要求

SequoiaFS 文件系统是基于 FUSE 在 Linux 系统下实现的一套文件系统,相当于用数据库做一个文件目录,其原理为 SequoiaFS 利用 SequoiaDB 的元数据集合存储文件和目录的属性信息，lob 对象存储文件的数据内容，从而实现了类似NFS分布式网络文件系统。用户可以将远程 SequoiaDB 的某个目标集合通过映射的方式挂载到本地 FS 节点，在 FS 节点的挂载目录下实现通过通用文件系统API对文件和目录进行操作

#### 知识点
1）创建集合空间和集合；

2）启动 SequoiaFS 服务；

3）SequoiaFS 正常使用；

## 挑战内容
1） 创建 fs_domain 域使用,在此域下创建集合空间 fscs，在此集合空间下创建集合 fscl ；

2）创建挂载点目录" /opt/sequoiadb/sequoiafs/mountpoint "；

3） 创建 SequoiaFS 的配置文件夹" /opt/sequoiadb/sequoiafs/conf/fscs_fscl/001/ "和日志目录" /opt/sequoiadb/sequoiafs/log/fscs_fscl/001/ " ；

4） 生成一个空的配置文件，SequoiaFS 服务在启动时会将指定的值写入该文件中，其他参数使用缺省值" /opt/sequoiadb/sequoiafs/conf/fscs_fscl/001/sequoiafs.conf " ；

5）启动 SequoiaFS 服务，挂载上面创建的目录（可参考学习章节 “启动 SequoiaFS 服务” 相关内容 ）；

6） 在 mount 目录下创建子目录 fsdir ，且在这个目录下创建文件 fsfile.txt 向文件 fsfile.txt 写入 " hello, this is a fsfile ! "；

7） 在数据库检查是否将文件夹中的文件挂载上去 ；


## 挑战要求

1）正确创建域,集合空间和集合；  

2）正确启动 SequoiaFS 服务；  

3）正确使用 SequoiaFS ；  
      
<!--    JSON代码  
、
1）登陆操作系统用户 sdbadmin；

```shell
su - sdbadmin
```
>Note:
>
>用户 sdbadmin 的密码为`sdbadmin`

2）创建 SequoiaDB 逻辑域、集合空间和集合；

```javascript
sdb 'var db = new Sdb ( "localhost", 11810 ) ;'
sdb 'db.createDomain ( "company_domain", ["group1", "group2", "group3"], { AutoSplit : true } ) ;'

sdb 'db.createCS ( "company", { Domain: "company_domain" } ) ;'

sdb 'db.company.createCL ( "employee", { "ShardingKey" : { "id" : 1 } , "ShardingType" : "hash" , "ReplSize" : -1 , "Compressed" : true , "CompressionType" : "lzw" , "AutoSplit" : true , "EnsureShardingIndex" : false } ) ;'

```

3) 插入数据

sdb 'db.company.employee.insert([{ "empno" : 10001 , "ename" : "Georgi" , "age" : 48 }, { "empno" : 10002 , "ename" : "Bezalel" , "age" : 21 }, { "empno" : 10003 , "ename" : "Parto" , "age" : 33 }, { "empno" : 10004 , "ename" : "Chirstian" , "age" : 40 }, { "empno" : 10005 , "ename" : "Kyoichi" , "age" : 23 }, { "empno" : 10006 , "ename" : "Anneke" , "age" : 19 }])' 

4) 连接查询
sdb 'db.company.employee.find({age:{$lt:30,$gt:20}})'

5) 修改删除数据

sdb 'db.company.employee.find({empno:10001})'
sdb 'db.company.employee.update({$set:{age:34}},{empno:10001})'
sdb 'db.company.employee.remove({empno:10006})'

-->

<!-- NFS代码

1）创建专属域和对应集合

sdb 'var db = new Sdb ( "localhost", 11810 ) ;'

sdb 'db.createDomain ( "fs_domain", ["group1", "group2", "group3"], { AutoSplit : true } ) ;'

sdb 'db.createCS ( "fscs", { Domain: "fs_domain" } ) ;'

sdb 'db.fscs.createCL ( "fscl") ;'

2）创建挂载点和配置目录

mkdir -p /opt/sequoiadb/sequoiafs/mountpoint
mkdir -p /opt/sequoiadb/sequoiafs/conf/fscs_fscl/001/
mkdir -p /opt/sequoiadb/sequoiafs/log/fscs_fscl/001/ 
touch /opt/sequoiadb/sequoiafs/conf/fscs_fscl/001/sequoiafs.conf

3) 进行挂载

sequoiafs /opt/sequoiadb/sequoiafs/mountpoint -i localhost:11810 -l fscs.fscl --autocreate -c /opt/sequoiadb/sequoiafs/conf/fscs_fscl/001/ --diagpath  /opt/sequoiadb/sequoiafs/log/fscs_fscl/001/ -o big_writes -o max_write=131072 -o max_read=131072

4）查看挂载后集合信息

sdb 'db.list(4)'|grep sequoiafs

5) 进行文件写入

chmod 750 /opt/sequoiadb/sequoiafs/mountpoint
cd /opt/sequoiadb/sequoiafs/mountpoint/
mkdir fsdir
touch fsfile.txt
echo 'hello, this is a fsfile ! ' >> fsfile.txt

6) 查看是否挂载文件成功
sdb 'db.fscs.fscl.find()'
-->
    
     

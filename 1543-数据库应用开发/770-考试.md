---
show: step
version: 2.0 
---
# 考试

## 挑战介绍

SequoiaS3 系统实现通过 AWS S3 接口访问 SequoiaDB 的能力,SequoiaS3 将 S3 接口中的区域、桶和对象映射为 SequoiaDB 中的集合空间，集合，记录和Lob，实现桶的增、删、查，对象的增、删、查，对象的版本管理，以及分段上传的能力，支持从 Amazon S3 或其他实现 S3 接口的存储服务平滑迁移到SequoiaDB数据库

#### 知识点

使用S3对象存储;

## 挑战内容

1）SequoiaDB开启RC级别事务，且配置为等锁模式;

2）创建S3专属域domain1,并在config/application.properties进行相应配置

3）启动S3

## 挑战要求

正确配置并启动S3

## 示例代码
```shell
sdb
var db = new Sdb ("localhost", 11810) ;
db.updateConf ( { transactionon : true , transisolation : 1 ,  translockwait : true } ) ;
db.createDomain("domain1", ["datagroup"], { AutoSplit : true } ) ;

sudo vim /opt/sequoiadb/tools/sequoias3/config/application.properties
server.port=8002
sdbs3.sequoiadb.url=sequoiadb://localhost:11810
sdbs3.sequoiadb.meta.domain=domain1

/opt/sequoiadb/tools/sequoias3/sequoias3.sh start
```

## 挑战介绍

SequoiaFS 文件系统是基于 FUSE 在 Linux 系统下实现的一套文件系统,相当于用数据库做一个文件目录,其原理为 SequoiaFS 利用 SequoiaDB 的元数据集合存储文件和目录的属性信息，lob 对象存储文件的数据内容，从而实现了类似NFS分布式网络文件系统。用户可以将远程 SequoiaDB 的某个目标集合通过映射的方式挂载到本地 FS 节点，在 FS 节点的挂载目录下实现通过通用文件系统API对文件和目录进行操作

#### 知识点

NFS文件系统的使用

## 挑战内容
1） 创建fs_domain域,在此域下创建集合空间fscs，在此集合空间下创建集合fscl ；

2) 创建挂载点目录(/opt/sequoiadb/sequoiafs/mountpoint) ；

3) 创建sequoiafs的配置文件夹(/opt/sequoiadb/sequoiafs/conf/fscs_fscl/001/)和日志目录(/opt/sequoiadb/sequoiadb/sequoiafs/log/fscs_fscl/001/) ；

4) 创建一个空配置文件(/opt/sequoiadb/sequoiafs/conf/fscs_fscl/001/sequoiafs.conf) ；

5) 启动sequoiafs服务 ；

6) 在mount目录创建fsdir文件夹,输入hello 到fsfile.txt ；

7) 检查数据库是否将文件夹中的文件挂载上去 ；

8）将挂载文件夹删除，检查数据库中是否把lob删除 。


## 示例代码

连接数据库查询

```shell
sdb 'db = new Sdb("localhost",11810)'
sdb 'db.list(4)'|grep sequoiafs
```

创建挂载点

```shell
mkdir -p /opt/sequoiadb/mountpoint
```

创建配置文件夹
```shell
mkdir -p /opt/sequoiadb/sequoiafs/conf/fscs_fscl/001/
mkdir -p /opt/sequoiadb/sequoiafs/log/fscs_fscl/001/
```
创建配置文件
```shell
touch /opt/sequoiadb/sequoiafs/conf/fscs_fscl/001/sequoiafs.conf
```
启动服务

```shell
sequoiafs /opt/sequoiadb/sequoiafs/mountpoint -i localhost:11810 -l fscs.fscl --autocreate -c /opt/sequoiadb/sequoiafs/conf/fscs_fscl/001/ --diagpath  /opt/sequoiadb/sequoiafs/log/fscs_fscl/001/ -o big_writes -o max_write=131072 -o max_read=131072
```

创建文件夹且写入文件

```shell
mkdir -p /opt/sequoiadb/sequoiafs/mountpoint/fsdir
cd /opt/sequoiadb/sequoiafs/mountpoint/fsdir
echo 'hello, this is a fsfile!' >> fsfile.txt
```

检查Lob文件
```shell
var db = new Sdb ("localhost", 11810) ;
db.sequoiafs.fscl_file142361856883863522.find();
db.sequoiafs.fscl_dir142361856883863522.find();
db.fscs.fscl.listLobs();
```
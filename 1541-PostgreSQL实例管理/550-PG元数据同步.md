**PostgreSQL执行计划**

**课程介绍**

查看分析SequoiaDB访问计划，并在PostgreSQL中通过explian analyze展现。

**在SequoiaDB中模拟插入数据：**

sdb
Welcome to SequoiaDB shell!
help() for help, Ctrl+c or quit to exit

db = new Sdb()
localhost:11810
Takes 0.003568s.

for (var i=1006; i<=50000; i++) {db.sample.customer.insert({cid:i, name:"customer_name_", addr: "address_", phoneno:"905-555-0001"})}

操作截图：

![图片描述](https://doc.shiyanlou.com/courses/1541/1207281/b338c3ee502dcea2010c1f44061bf5a5)

**查询记录数：**

db.sample.customer.count()
49001
Takes 0.071149s.

**执行条件查询，查询cid = 49000的customer信息：**

db.sample.customer.find( { cid: 49000 } )

操作截图：

![图片描述](https://doc.shiyanlou.com/courses/1541/1207281/83b071ff7dbb0787e8ea46167f4e54bb)

**再次执行同样的条件查询，查询cid = 49000的customer信息，并显示访问计划：**

db.sample.customer.find( { cid: 49000 } ).explain( { Run : true } )

操作截图：

![图片描述](https://doc.shiyanlou.com/courses/1541/1207281/88f6dc8781c8d56121e8ec5a58bc806d)

注：其中  "ScanType": "tbscan" ，表示全表扫描。

**在customer表的cid字段上创建唯一索引，再次执行上述条件查询，并显示访问计划：**

db.execUpdate("create unique index idx_cid on sample.customer(cid)")

db.sample.customer.find( { cid: 49000 } ).explain( { Run : true } )

操作截图：

![图片描述](https://doc.shiyanlou.com/courses/1541/1207281/a1accb57f7aacc7646e153e6d9bfedaf)

注：其中 "ScanType": "ixscan", "IndexName": "idx_cid", 表示使用索引idx_cid进行扫描。

quit

**在PostgreSQL查看执行上述条件查询语句：**

psql -d sample

psql (9.3.4)
Type "help" for help.

select * from customer where cid = 49000;

操作截图：

![图片描述](https://doc.shiyanlou.com/courses/1541/1207281/49d3aa777a5c1fc63dc584c92bdea47e)

**在PostgreSQL查看执行条件查询语句，并查看执行计划：**

explain analyze select * from customer where cid = 49000;

操作截图：

![图片描述](https://doc.shiyanlou.com/courses/1541/1207281/fe28e3b6b856777aeb8ae888efa4e754)

注：PostgreSQL的执行计划中，显示“ Foreign Scan on customer”, 外部表的访问优化在SequoiaDB中完成。

**退出PostgreSQL Shell：**

\q


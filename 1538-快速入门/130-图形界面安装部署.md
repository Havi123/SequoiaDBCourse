---
show: step
version: 1.0
enable_checker: true
---
# 演示图形界面安装部署巨杉数据库集群以及搭建MySQL实例

#### 课程介绍

本入门教程 介绍如何基于图形界面安装部署巨杉数据库集群以及创建MySQL实例。

#### 请点击右侧选择使用的实验环境

#### 部署架构：
本课程中 SequoiaDB 巨杉数据库的集群拓扑结构为三分区单副本，其中包括：1个 SequoiaSQL-MySQL 数据库实例节点、1个引擎协调节点，1个编目节点与3个数据节点。

![图片描述](https://doc.shiyanlou.com/courses/1469/1207281/8d88e6faed223a26fcdc66fa2ef8d3c5)

详细了解 SequoiaDB 巨杉数据库系统架构：
* [SequoiaDB 系统架构](http://doc.sequoiadb.com/cn/sequoiadb-cat_id-1519649201-edition_id-0)

#### 实验环境
课程使用的实验环境为 Ubuntu Linux 16.04 64 位版本。


## 安装巨杉数据库

#### 切换到 root 用户

安装 SequoiaDB 巨杉数据库需要 root 用户权限
```
su - root
```
> Note:
> 
> 用户 root 的密码为 root123456

#### 切换目录至安装介质所在目录

安装介质存放的目录为：/root/software
```
cd /root/software
```

#### 巨杉数据库安装步骤

1) 以 root 用户赋予 `sequoiadb-3.4-linux_x86_64-enterprise-installer.run` 安装包可执行权限
```
chmod u+x sequoiadb-3.4-linux_x86_64-enterprise-installer.run
chmod u+x sequoiasql-mysql-3.4-linux_x86_64-enterprise-installer.run
```

2) 使用 root 用户运行 `sequoiadb-3.4-linux_x86_64-enterprise-installer.run` 安装包
```
./sequoiadb-3.4-linux_x86_64-enterprise-installer.run --mode text
```

3) 提示选择向导语言，可根据需要输入 1 选择英文，或者输入 2 选择中文
```
Language Selection

Please select the installation language
[1] English - English
[2] Simplified Chinese - 简体中文
Please choose an option [1] : 2
```

4) 显示安装协议，输入 1 表示忽略阅读并同意协议，输入 2 表示读取完整协议内容
```
----------------------------------------------------------------------------
由BitRock InstallBuilder评估本所建立

欢迎来到 SequoiaDB Server 安装程序

----------------------------------------------------------------------------
重要信息：请仔细阅读

下面提供了两个许可协议。

1. SequoiaDB 评估程序的最终用户许可协议
2. SequoiaDB 最终用户许可协议

如果被许可方为了生产性使用目的（而不是为了评估、测试、试用“先试后买”或演示）获得本程序，单击下面的“接受”按钮即表示被许可方接受 SequoiaDB 最终用户许可协议，且不作任何修改。

如果被许可方为了评估、测试、试用“先试后买”或演示（统称为“评估”）目的获得本程序：单击下面的“接受”按钮即表示被许可方同时接受（i）SequoiaDB 评估程序的最终用户许可协议（“评估许可”），且不作任何修改；和（ii）SequoiaDB 最终用户程序许可协议（SELA），且不作任何修改。

在被许可方的评估期间将适用“评估许可”。

如果被许可方通过签署采购协议在评估之后选择保留本程序（或者获得附加的本程序副本供评估之后使用），SequoiaDB 评估程序的最终用户许可协议将自动适用。

“评估许可”和 SequoiaDB 最终用户许可协议不能同时有效；两者之间不能互相修改，并且彼此独立。

这两个许可协议中每个协议的完整文本如下。

评估程序的最终用户许可协议



[1] 同意以上协议: 了解更多的协议内容，可以在安装后查看协议文件
[2] 查看详细的协议内容
请选择一个选项 [1] : 1
```

5) 指定 SequoiaDB 安装路径，输入完毕后按回车。若没有输入直接回车，将使用默认的安装路径（/opt/sequoiadb）
```
----------------------------------------------------------------------------
请指定 SequoiaDB Server 将会被安装到的目录

安装目录 [/opt/sequoiadb]:
```

6) 询问是否强制安装，y 表示强制安装，安装时发现有相关进程存在则会尝试停止进程，N 表示非强制安装，安装时发现有相关进程存在，就会报错退出。默认为非强制安装
```
----------------------------------------------------------------------------
是否强制安装？强制安装时可能会强杀残留进程

是否强制安装 [y/N]: n
```

7) 提示配置 Linux 用户名和用户组，输入完毕后按回车。若没有输入直接回车，将会创建默认的用户名（sdbadmin）和用户组（sdbadmin_group）。该用户名用于运行 SequoiaDB 服务
```
----------------------------------------------------------------------------
数据库管理用户配置

配置用于启动SequoiaDB的用户名、用户组和密码

用户名 [sdbadmin]:

用户组 [sdbadmin_group]:
```

8) 提示配置刚才创建的 Linux 用户的密码，输入完毕后按回车。若没有输入直接回车，将会使用默认密码（sdbadmin）
```
密码 [********] :
确认密码 [********] :
```

9) 提示配置服务端口，输入完毕后按回车。若没有输入直接回车，将使用默认的服务端口号（11790）
```
----------------------------------------------------------------------------
集群管理服务端口配置

配置SequoiaDB集群管理服务端口,集群管理用于远程启动添加和启停数据库节点

集群管理服务端口 [11790]:
```

10) 询问是否允许 SequoiaDB 巨杉数据库相关进程开机自启动，Y 表示允许，n 表示不允许。默认为允许
```
----------------------------------------------------------------------------
是否允许Sequoiadb相关进程开机自启动？

Sequoiadb相关进程开机自启动 [Y/n]: y
```

11) 询问是否安装 OM 服务，1 表示安装 2 表示不安装
```
----------------------------------------------------------------------------
是否安装OM服务

[1] true
[2] false
[3] only
请选择一个选项 [2] : 1
```

12) 询问是否继续安装，Y 表示继续，n 表示不继续。默认为继续
```
------------------------------------------------------------
设定现在已经准备将 SequoiaDB Server 安装到您的电脑.
您确定要继续? [Y/n]:
```

13) 当屏幕上显示以下信息，表示 SequoiaDB 已经安装完成
```
----------------------------------------------------------------------------
正在安装 SequoiaDB Server 于您的电脑中，请稍候.

 安装中
 0% ______________ 50% ______________ 100%
 #########################################

----------------------------------------------------------------------------
安装程序已经完成安装 SequoiaDB Server 于你的电脑中.
```

#### 打开桌面浏览器连接图形界面

巨杉数据库的图形界面默认监听端口为：8000，默认用户密码均为 admin

#### 安装部署

1）点击 "一键部署"

2）在弹出的部署信息窗口中，填写集群名，用户名、密码，用户组是指在安装 SequoiaDB 软件时创建的Linux 用户，点击 "确定"

3）在扫描主机界面，填写集群的IP地址/主机名，root用户的密码，点击"扫描"按钮，旁边的主机列表状态为"连接成功"，表示参数填写正确，点击"下一步"

4）勾选安装巨杉数据库软件的主机，点击"下一步"

5) 等待主机安装巨杉数据库软件成功后，点击"下一步"

6）根据 SequoiaDB 巨杉数据库的集群拓扑结构为三分区单副本，因此部署副本数为 1，分区组数为 3，编目节点和协调节点数为1，点击"下一步"

7) 点击节点列表的任意节点，配置该节点参数信息，若采用默认配置，则点击"下一步"

8) 等待集群部署完毕后，提示是否创建 SQL 实例，选择是

9) 将 MySQL 实例安装包复制到 SequoiaDB 巨杉数据库安装目录下的 packet 目录
```
mv /root/software/sequoiasql-mysql-3.4-linux_x86_64-enterprise-installer.run /opt/sequoiadb/packet/
```

10) 配置 MySQL 实例安装路径、数据路径，root用户密码等信息，点击"下一步"

11）等待 MySQL 实例部署完成

12) 提示是否为实例添加分布式存储，点击"是"

13) 在弹出的添加实例存储窗口，配置实例连接分布式存储的信息，"高级"标签配置更多参数信息，点击"确定"

14) 添加实例存储成功后，对应实例的界面中存储集群会显示该实例对应的分布式存储

#### MySQL实例操作

在图形界面的"数据"界面，提供对实例的图形界面数据增删查改功能

1）点击"数据"界面下的 "MySQLInstance" 实例

2) 点击"创建数据库"，创建 company 数据库

3) 创建包含自增主键字段的 employee 表，对应的表定义如下
```sql
CREATE TABLE employee (empno INT PRIMARY KEY, ename VARCHAR(128), age INT) ;
```

4） 点击"employee" 表名，插入数据
```sql
INSERT INTO employee (empno,ename, age) VALUES (1,"Jacky", 36) ;
INSERT INTO employee (empno,ename, age) VALUES (2,"Alice", 18) ;
```

5) 查看"employee"表的数据
```sql
select * from employee;
```

6）创建普通数据表 manager 表，对应的表定义如下
```sql
CREATE TABLE manager (empno INT, department TEXT) ;
```

7) 点击"manager"表名，插入数据
```sql
INSERT INTO manager VALUES (1, "Sales Department") ;
```

8) 查看"manager"表的数据
```
select * from employee;
```

#### 使用 MySQL Shell 查看数据

1) 使用 sdbadmin 用户登录主机

2) 登录 MySQL shell
```
/opt/sequoiasql/mysql/bin/mysql -h 127.0.0.1 -P 3306 -u root
```

3）查看 company.employee 表的数据
```sql
use company;
select * from employee;
```

4) 查看 company.manager 表的数据
```sql
use company;
select * from manager;
```

5) 退出 MySQL Shell
```
\q
```

#### 使用 Sdb Shell 查看数据表

1) 使用 sdbadmin 用户登录主机

2）登录 SDB Shell
```
/opt/sequoiadb/bin/sdb
```

3) 建立数据库连接
```
db = new Sdb()
```

4) 查看 company.employee 数据表在分布式存储应该是以"empno" 字段进行 hash 切分存储在多个分区组上
```
db.snapshot(SDB_SNAP_CATALOG, {"Name":"company.employee"})
```

5) 查看company.manager 数据表在分布式存储中是一个普通数据表，存储在某个分区组上
```
db.snapshot(SDB_SNAP_CATALOG, {"Name":"company.manager"})
```

6) 断开数据库连接
```
db.close();
```

7) 退出 SDB Shell
```
quit
```

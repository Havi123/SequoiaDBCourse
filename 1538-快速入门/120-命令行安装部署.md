---
show: step
version: 1.0
enable_checker: true
---
# 命令行安装部署

## 课程介绍

本入门教程 介绍整个 SequoiaDB 的命令行安装部署，如何通过命令行脚本安装部署SDB与MySQL实例。


## 准备安装介质

解压 SequoiaDB 安装介质 sequoiadb-3.4-linux_x86_64.tar.gz，并给解压得到的 run 包增加可执行权限
```
tar -zxvf sequoiadb-3.4-linux_x86_64.tar.gz 
cd sequoiadb-3.4
chmod u+x sequoiadb-3.4-linux_x86_64-installer.run
chmod u+x sequoiasql-mysql-3.4-linux_x86_64-installer.run
chmod u+x sequoiasql-postgresql-3.4-x86_64-installer.run
chmod u+x setup.sh
```

## 切换用户

1）命令行输入更新 root 密码命令
```
sudo passwd root
```
2）在 `[sudo] password for shiyanlou:` 后输入当前用户的密码

> Note:
> 当前用户的密码在右侧工具栏 [SSH直连]

3）当前用户密码验证通过后, 输入需要设置的 root 超级管理员账户密码 `Enter new UNIX password:` 
4）再次输入密码，验证输入的密码 `Retype new UNIX password:`
5）出现 `passwd: password updated successfully` 字样，表示超级管理员 root 账户密码设置成功
6）切换至 root 用户，验证超级管理账户密码是否更新成功，验证通过则成功切换到超级管理员 root 账户
```
su root
```

## 安装 SequoiaDB 数据库

1）运行安装脚本
```
./setup.sh
```

2）程序提示选择安装SequoiaDB，默认是安装，输入N不安装
```
Install sequoiadb Y/n:
```

3）程序提示开始安装SequoiaDB，选择向导语言，输入2，选择中文
```
----------------------------begin to install sequoiadb----------------------------
./sequoiadb-3.4-linux_x86_64-installer.run --mode text
Language Selection

Please select the installation language
[1] English - English
[2] Simplified Chinese - 简体中文
Please choose an option [1] : 2
```

4）显示安装协议，直接按回车键忽略阅读并同意协议
```
------------------------------------------------------------
由 BitRockInstallBuilder 评估本所建立
------------------------------------------------------------

欢迎来到 SequoiaDB Server 安装程序

重要信息：请仔细阅读

下面提供了两个许可协议。

1. SequoiaDB 评估程序的最终用户许可协议
2. SequoiaDB 最终用户许可协议

如果被许可方为了生产性使用目的（而不是为了评估、测试、试用“先试后买”或演示）获得本程序，单击下面的“接受”按钮即表示被许可方接受 SequoiaDB 最终用户许可协议，且不作任何修改。

如果被许可方为了评估、测试、试用“先试后买”或演示（统称为“评估”）目的获得本程序：单击下面的“接受”按钮即表示被许可方同时接受（i）SequoiaDB 评估程序的最终用户许可协议（“评估许可”），且不作任何修改；和（ii）SequoiaDB 最终用户程序许可协议（SELA），且不作任何修改。

在被许可方的评估期间将适用“评估许可”。

如果被许可方通过签署采购协议在评估之后选择保留本程序（或者获得附加的本程序副本供评估之后使用），SequoiaDB 评估程序的最终用户许可协议将自动适用。

“评估许可”和 SequoiaDB 最终用户许可协议不能同时有效；两者之间不能互相修改，并且彼此独立。

这两个许可协议中每个协议的完整文本如下。

评估程序的最终用户许可协议

[1] 同意以上协议: 了解更多的协议内容，可以在安装后查看协议文件
[2] 查看详细的协议内容
请选择选项 [1] :
```

5）输入安装路径后按回车（可直接按回车使用默认路径 /opt/sequoiadb ）
```
------------------------------------------------------------
请指定 SequoiaDB Server 将会被安装到的目录
安装目录 [/opt/sequoiadb]:
```

6）询问是否强制安装，直接按回车键选择否：
```
------------------------------------------------------------
是否强制安装？强制安装时可能会强杀残留进程
是否强制安装 [y/N]:
```

7）提示输入用户名和用户组（默认创建 sdbadmin 用户和 sdbadmin_group 用户组），该用户名用于运行 SequoiaDB 服务，本次均直接按回车使用默认值
```
------------------------------------------------------------
数据库管理用户配置
配置用于启动 SequoiaDB 的用户名、用户组和密码
用户名 [sdbadmin]:
用户组 [sdbadmin_group]:
```

8）提示输入该用户的密码和确认密码（默认密码为 sdbadmin ），本次均直接按回车使用默认值
```
密码 [********] :
确认密码 [********] :
```

9）输入两次密码后，此时系统提示输入配置服务端口（默认为11790），直接按回车使用默认值
```
------------------------------------------------------------
集群管理服务端口配置
配置SequoiaDB集群管理服务端口，集群管理用于远程启动添加和启停数据库节点
端口 [11790]:
```

10）询问是否允许 SequoiaDB 相关进程开机自启动，输入Y，按回车
```
------------------------------------------------------------
是否允许 SequoiaDB 相关进程开机自启动
Sequoiadb相关进程开机自启动 [Y/n]:
```

11）询问是否安装 OM 服务，输入 1 表示安装，默认不安装，按回车
```
----------------------------------------------------------------------------
是否安装OM服务

[1] true
[2] false
[3] only
请选择一个选项 [2] :
```

12）设置完成，询问是否继续安装，直接按回车选择是
```
----------------------------------------------------------------------------
设定现在已经准备将 SequoiaDB Server 安装到您的电脑.
您确定要继续? [Y/n]:
```

13）显示如下提示，表示 SequoiaDB Server 安装完成
```
正在安装 SequoiaDB Server 于您的电脑中，请稍候。
安装中
0% ______________ 50% ______________ 100%
#########################################
------------------------------------------------------------
安装程序已经完成安装 SequoiaDB Server 于你的电脑中.

----------------------------end install sequoiadb----------------------------
```

14）安装 SequoiaSQL，询问安装 sequoiasql-mysql or sequoiasql-postgresql，分别用 1 和 2 表示，默认是 1，回车安装 sequoiasql-mysql
```
Install 1:sequoiasql-mysql or 2:sequoiasql-postgresql, [1]:
```

15）程序提示选择向导语言，输入2，选择中文
```
--------------------------begin to install sequoiasql-mysql-------------------------
./sequoiasql-mysql-3.4-linux_x86_64-installer.run --mode text
Language Selection

Please select the installation language
[1] English - English
[2] Simplified Chinese - 简体中文
Please choose an option [1] : 2
```

16）显示安装协议，直接按回车键忽略阅读并同意协议
```
----------------------------------------------------------------------------
由BitRock InstallBuilder评估本所建立

欢迎来到 MySQL 实例安装程序

----------------------------------------------------------------------------
GNU 通用公共授权
第二版, 1991年6月
著作权所有 (C) 1989，1991 Free Software Foundation, Inc. 59 Temple Place, Suite 330, Boston, MA   02111-1307 USA.
允许每个人复制和发布本授权文件的完整副本，但不允许对它进行任何修改。

[1] 同意以上协议: 了解更多的协议内容，可以在安装后查看协议文件
[2] 查看详细的协议内容
请选择一个选项 [1] : 
```

17）输入安装路径后按回车（可直接按回车使用默认路径 /opt/sequoiasql/mysql ）
```
----------------------------------------------------------------------------
请指定 MySQL 实例将会被安装到的目录

安装目录 [/opt/sequoiasql/mysql]: 
```

18）提示输入用户名和用户组（默认创建 sdbadmin 用户和 sdbadmin_group 用户组），该用户名用于运行 SequoiaSQL 服务，本次均直接按回车使用默认值
```
----------------------------------------------------------------------------
数据库管理用户配置

配置用于启 MySQL 实例组件的用户名、用户组和密码

用户名 [sdbadmin]: 

用户组 [sdbadmin_group]: 
```

19）提示输入该用户的密码和确认密码（默认密码为 sdbadmin ），本次均直接按回车使用默认值
```
密码 [********]:
确认密码 [********]:
```

20）设置完成，询问是否继续安装，直接按回车选择是
```
----------------------------------------------------------------------------
设定现在已经准备将 MySQL 实例安装到您的电脑.

您确定要继续? [Y/n]: 
```

21）显示以下提示，表示 MySQL 实例安装完成
```
----------------------------------------------------------------------------
正在安装 MySQL 实例于您的电脑中，请稍候.

安装中
0% ______________ 50% ______________ 100%
#########################################

----------------------------------------------------------------------------
安装程序已经完成安装 MySQL 实例于你的电脑中.

----------------------------end install sequoiasql-mysql----------------------------
```

## 安装检查

1）切换到 sdbadmin 用户；
```
su - sdbadmin
```
> Note:
> sdbadmin 用户的密码: sdbadmin

2）执行以下命令检查 SequoiaDB 版本，如能正常查到 SequoiaDB 的版本信息，说明安装成功；
```
sequoiadb  --version
```

3）切换到 root 用户；
```
su - root
```

4）使用如下命令如能正常查到 sequoiasql-mysql 服务的状态，说明安装成功；
```
service sequoiasql-mysql status
```

## 部署 SequoiaDB 及 MySQL 实例

SequoiaDB 部署方案可以选择部署在单台机器上，或者部署在多台机器上。下面介绍的伪集群部署和集群部署， 只需要二者选一种执行。

#### 伪集群部署
部署 SequoiaDB 到本机上，创建 3 个数据组，每个数据组单副本。在本机上创建一个MySQL实例。

1）切换到 root 用户，检查端口是否被占用, SequoiaDB 默认需要的端口号为 11800、11810、11820、11830、11840、18800，MySQL 实例默认需要的端口号为 3306；
```
netstat -anp | grep -e "11800" -e "11810" -e "11820" -e "11830" -e "11840" -e "18800" -e "3306"
```

2）切换到 sdbadmin 用户；
```
su - sdbadmin
```
> Note:
> sdbadmin 用户默认为 sdbadmin

3）切换到 SequoiaDB 安装目录；
```
cd /opt/sequoiadb
```

4）运行快速部署脚本；
```
./tools/deploy/quickDeploy.sh --sdb --mysql
```

5）显示以下提示，表示 SequoiaDB 集群和 SequoiaSQL-MySQL 实例部署完成；
```
************ Deploy SequoiaDB ************************
Create catalog: f15c759bdf62:11800
Create coord:   f15c759bdf62:11810
Create data:    f15c759bdf62:11820
Create data:    f15c759bdf62:11830
Create data:    f15c759bdf62:11840

************ Deploy SequoiaSQL-MySQL *****************
Create instance: [name: myinst, port: 3306]
```

> Note:
>
> 快速部署工具的使用与配置，具体请参考 quickDeploy.sh
> 
> 错误处理：如果执行快速部署工具的过程中，发生异常，如端口占用，在恢复异常后，即端口可用后，可尝试再次执行 quickDeploy.sh 命令。如果再次执行 quickDeploy.sh 也失败，请先用解压目录下的 unset.sh 清除所有的安装部署，重头按快速入门教程执行命令。


## 验证部署

1）登录 MySQL Shell；
```
/opt/sequoiasql/mysql/bin/mysql -h 127.0.0.1 -P 3306 -u root
```

2）创建数据库实例；
```sql
CREATE DATABASE company ;
USE company ;
```

3）创建包含自增主键字段的 employee 表；
```sql
CREATE TABLE employee (empno INT AUTO_INCREMENT PRIMARY KEY, ename VARCHAR(128), age INT) ;
```

4）向 employee 表写入数据；

```sql
INSERT INTO employee (ename, age) VALUES ("Jacky", 36) ;
INSERT INTO employee (ename, age) VALUES ("Alice", 18) ;
```

5）查询 employee 表的数据；
```sql
SELECT * FROM employee ;
```

6）更新 employee 表的数据；
```sql
UPDATE employee SET age = 35 WHERE ename ="Jacky" ;
```

7）删除 employee 表的数据；
```sql
DELETE FROM employee WHERE ename = "Alice" ;
```

8）查询 employee 表的数据；
```sql
SELECT * FROM employee ;
```

9）退出 MySQL Shell；
```
\q
```
## 总结
本课程主要讲述 SequoiaDB 和 SequoiaSQL-MySQL 实例的命令行安装部署，同时也创建了数据库和数据表进行测试。
